pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	local opt={
		st='idle',
		anims={
			idle={
				{2,10},
				{3,5}
			},
			walk={
				{4,3},
				{5,1},
				{6,1}, 
				{7,1},
				{8,3}
			},
			eldritch_walk={
				{0,3},
				{1,3},
				{16,3},
				{17,3},
				{32,3},
				{33,3}
			}
		},
	}

	mgr=mk_anim_mgr(opt)
	menu=mk_menu()
end

function _update()
	mgr:update()
	menu:update()
end

function _draw()
	cls()
	spr(mgr:cur_spr(),60,40)
	draw_anim_st_str()
	menu:draw(40,80)
end

function draw_anim_st_str()
	local str="animation state: "
	str=str..mgr.st
	print(str,4,70,6)
end
-->8
function mk_anim_mgr(opt)
	local mgr={
		st=opt.st,
		anims=opt.anims,
		cf=1,
		t=0,
	}
	
	mgr.cur_anim=function(s)
	 return	s.anims[s.st]
	end
	
	mgr.cur_spr=function(s)
		return s:cur_anim()[s.cf][1]
	end
	
	mgr.update=function(s)
		s.t+=1
		local anim=s:cur_anim()
		if(s.t>anim[s.cf][2])then
			s.t=0
			s.cf+=1
		end
		if(s.cf>#anim)s.cf=1
	end
	
	return mgr
end
-->8
function mk_menu()
	local menu={
	 opt={'idle','walk','eldritch_walk'},
	 sel=1
	}
	
	menu.update=function(s)
		if(btnp(⬇️))then
			s.sel+=1
			if(s.sel>#s.opt)s.sel=1
		end
		if(btnp(⬆️))then
			s.sel-=1
			if(s.sel<1)s.sel=#s.opt
		end
		if(btnp(🅾️))then
			mgr.st=s.opt[s.sel]
			mgr.cf=1
			mgr.t=1
		end
	end
	
	menu.draw=function(s,x,y)
		rect(x,y,x+68,y+44,13)
		for i,o in ipairs(s.opt) do
			local c=5
			if(i==s.sel)c=7
			print(o,x+10,y+(10*i),c)
		end
	end
	
	return menu
end
__gfx__
07777000077770000077770000000000007777000077770000777700000000000000000000000000000000000000000000000000000000000000000000000000
70000700700007000700007000777700070000700700007007000070007777000000000000000000000000000000000000000000000000000000000000000000
70000700700007000700007007000070070000700700007007000070070000700000000000000000000000000000000000000000000000000000000000000000
70700700700007000700007007000070070000700777777007000070070000700077770000000000000000000000000000000000000000000000000000000000
07777000077770000077770007000070007777000007700007000070070000700700007000000000000000000000000000000000000000000000000000000000
00770000007700000007700000777700000770000007770000777700007777000700007000000000000000000000000000000000000000000000000000000000
07070000007700000007700000077000000777000007000000070700000770000077770000000000000000000000000000000000000000000000000000000000
00070000077770000070070000700700007000000000000000000000000070000000700000000000000000000000000000000000000000000000000000000000
00000000000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777000007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000700007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000700007007070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000700000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777000000077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00770000000070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700007000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700007007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700007007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077770007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007700000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007700000077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077770000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
